<script src="../../dist/vue.global.js"></script>

<div id="root"></div>

<script>
  const {
    defineAsyncComponent,
    defineComponent,
    createApp,
    ref,
    h,
    onBeforeMount,
    onMounted,
    inject
  } = Vue

  const App = defineComponent({
    props: ['x'],
    setup(props) {
      const user = inject('user')
      const count = ref(0)
      const add = () => {
        count.value++
      }

      onBeforeMount(() => {
        console.log('BeforeMount')
      })

      onMounted(() => {
        console.log('Mounted')
      })

      return () => {
        return h(
          'Test',
          {
            onClick: add
          },
          // '888'
          [`count is: ${count.value} ${user} ${props.x}`, h(AsyncComp)]
        )
      }
    }
  })

  const app = createApp(App, {
    x: 1
  })

  // debugger;
  const AsyncComp = defineAsyncComponent(
    () =>
      new Promise((resolve, reject) => {
        setTimeout(() => {
          resolve({
            name: 'haha',
            render() {
              return h('div', {}, 'haha')
            }
          })
        }, 1000)
      })
  )

  app.component('async-component', AsyncComp)

  // debugger;
  // app.component('Node', {
  //   render() {
  //     return h('div', {}, 'node')
  //   }
  // })

  // debugger;
  // app.mixin({
  //   data() {
  //     return {
  //       x: 1
  //     }
  //   }
  // })

  // debugger
  app.provide('user', 'administrator')

  // debugger
  app.use({
    install(app) {
      console.log(app, '11')
    }
  })

  // debugger
  app.mount('#root')

  // setTimeout(() => {
  //   debugger;
  //   app.unmount()
  // }, 3000)
</script>
